name: Victor-Invest Nightly Live Benchmark

on:
  schedule:
    - cron: "0 6 * * *"
  workflow_dispatch:
    inputs:
      symbol:
        description: "Symbol to benchmark (default AAPL)"
        required: false
        default: "AAPL"

env:
  PYTHON_VERSION: "3.11"

jobs:
  nightly-live-benchmark:
    name: Nightly Live Workflow Benchmark
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -e ".[dev]"

      - name: Run nightly live benchmark (non-blocking)
        continue-on-error: true
        env:
          BENCHMARK_SYMBOL: ${{ github.event.inputs.symbol }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          FRED_API_KEY: ${{ secrets.FRED_API_KEY }}
          SEC_USER_AGENT: ${{ secrets.SEC_USER_AGENT }}
        run: |
          SYMBOL="${BENCHMARK_SYMBOL:-AAPL}"
          python3 scripts/benchmark_victor_workflows.py \
            --runner cli \
            --budget-profile production \
            --force-refresh \
            --symbol "${SYMBOL}" \
            --modes quick standard comprehensive \
            --output-json artifacts/benchmarks/workflow_benchmark_nightly_live.json

      - name: Upload nightly benchmark artifact
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: workflow-benchmark-nightly-live
          path: artifacts/benchmarks/workflow_benchmark_nightly_live.json
          retention-days: 30
