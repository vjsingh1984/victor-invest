flowchart LR
    subgraph Input["ğŸ“¥ Input Sources"]
        TICKER[ğŸ·ï¸ Stock Symbol<br/>e.g., AAPL]
        CONFIG[âš™ï¸ config.json<br/>System Configuration]
    end
    
    subgraph "ğŸ” Data Collection"
        CIK_LOOKUP[ğŸ†” CIK Lookup<br/>SEC ticker.txt]
        SEC_SUB[ğŸ“‹ SEC Submissions<br/>EDGAR API]
        SEC_FACTS[ğŸ“Š Company Facts<br/>XBRL Data]
        FRAME_API[ğŸ—ï¸ Frame API<br/>Quarterly Metrics]
        YAHOO_PRICE[ğŸ“ˆ Price Data<br/>Yahoo Finance]
    end
    
    subgraph "âš™ï¸ Data Processing"
        QPARSE[ğŸ“… Quarterly Parsing<br/>Financial Periods]
        FILING_PARSE[ğŸ“„ Filing Parser<br/>10-K/10-Q Analysis]
        TECH_IND[ğŸ“Š Technical Indicators<br/>30+ Calculations]
        SCORE_CALC[ğŸ¯ Score Calculation<br/>0-10 Scale]
    end
    
    subgraph "ğŸ¤– AI Analysis"
        FUND_LLM[ğŸ’¼ Fundamental LLM<br/>SEC Filing Analysis]
        TECH_LLM[ğŸ“ˆ Technical LLM<br/>Indicator Analysis]
        SYNTH_LLM[ğŸ”— Synthesis LLM<br/>Combined Analysis]
    end
    
    subgraph "ğŸ’¾ Storage & Cache"
        DISK_CACHE[ğŸ’½ Disk Cache<br/>JSON + gzip]
        DB_CACHE[ğŸ—„ï¸ Database Cache<br/>PostgreSQL JSONB]
        PARQUET[ğŸ“¦ Parquet Files<br/>Technical Data]
        LLM_CACHE[ğŸ§  LLM Cache<br/>Prompts + Responses]
    end
    
    subgraph "ğŸ“Š Output Generation"
        PDF_REPORT[ğŸ“„ PDF Report<br/>Investment Analysis]
        EMAIL_ALERT[ğŸ“§ Email Alert<br/>Optional Delivery]
        JSON_EXPORT[ğŸ”— JSON Export<br/>Structured Data]
        LOGS[ğŸ“‹ Logs<br/>Processing Details]
    end
    
    %% Data flow connections
    TICKER --> CIK_LOOKUP
    CIK_LOOKUP --> SEC_SUB
    CIK_LOOKUP --> SEC_FACTS
    CIK_LOOKUP --> FRAME_API
    TICKER --> YAHOO_PRICE
    
    SEC_SUB --> QPARSE
    SEC_FACTS --> QPARSE
    FRAME_API --> QPARSE
    SEC_SUB --> FILING_PARSE
    
    YAHOO_PRICE --> TECH_IND
    QPARSE --> SCORE_CALC
    TECH_IND --> SCORE_CALC
    
    QPARSE --> FUND_LLM
    FILING_PARSE --> FUND_LLM
    TECH_IND --> TECH_LLM
    FUND_LLM --> SYNTH_LLM
    TECH_LLM --> SYNTH_LLM
    
    %% Cache connections
    SEC_SUB --> DISK_CACHE
    SEC_FACTS --> DISK_CACHE
    FUND_LLM --> LLM_CACHE
    TECH_LLM --> LLM_CACHE
    SYNTH_LLM --> LLM_CACHE
    YAHOO_PRICE --> PARQUET
    
    DISK_CACHE --> DB_CACHE
    LLM_CACHE --> DB_CACHE
    
    %% Output connections
    SYNTH_LLM --> PDF_REPORT
    PDF_REPORT --> EMAIL_ALERT
    SYNTH_LLM --> JSON_EXPORT
    CONFIG --> LOGS
    
    %% Cache read paths (dotted lines for retrieval)
    DISK_CACHE -.->|Cache Hit| FUND_LLM
    DB_CACHE -.->|Cache Hit| TECH_LLM
    PARQUET -.->|Historical Data| TECH_IND
    LLM_CACHE -.->|Previous Analysis| SYNTH_LLM
    
    %% Styling
    classDef input fill:#e8f5e8,stroke:#4caf50,stroke-width:2px
    classDef collection fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
    classDef processing fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    classDef ai fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    classDef storage fill:#fce4ec,stroke:#e91e63,stroke-width:2px
    classDef output fill:#e0f2f1,stroke:#009688,stroke-width:2px
    
    class TICKER,CONFIG input
    class CIK_LOOKUP,SEC_SUB,SEC_FACTS,FRAME_API,YAHOO_PRICE collection
    class QPARSE,FILING_PARSE,TECH_IND,SCORE_CALC processing
    class FUND_LLM,TECH_LLM,SYNTH_LLM ai
    class DISK_CACHE,DB_CACHE,PARQUET,LLM_CACHE storage
    class PDF_REPORT,EMAIL_ALERT,JSON_EXPORT,LOGS output